---
import { getCollection, render } from 'astro:content';
import LogbookLayout from '../../layouts/LogbookLayout.astro';

// 1. Generate static paths for all logs
export async function getStaticPaths() {
  const logs = await getCollection('logs');
  return logs.map(entry => ({
    params: { slug: entry.slug }, props: { entry },
  }));
}

// 2. Get the entry from props
const { entry } = Astro.props;
const { Content } = await render(entry);

import AudioPlayer from '../../components/media/AudioPlayer.svelte';
---

<LogbookLayout title={entry.data.title}>
  
  <article>
    <!-- Header Meta -->
    <header class="mb-10">
      <div class="flex items-center gap-3 mb-4">
        <a href="/" class="text-xs font-mono text-zinc-400 hover:text-zinc-900">‚Üê BACK TO INDEX</a>
        <span class="text-zinc-300">|</span>
        <span class="text-xs font-mono text-zinc-400 uppercase">
          {entry.data.date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}
        </span>
      </div>

      <h1 class="font-sans text-4xl md:text-5xl font-bold tracking-tighter text-zinc-900 mb-6">
        {entry.data.title}
      </h1>

      <!-- Technical Data Grid -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 border-y border-zinc-200 py-4 font-mono text-[10px] uppercase tracking-widest text-zinc-500 mb-8">
        <div>
          <span class="block text-zinc-300">BPM</span>
          {entry.data.bpm || 'Free'}
        </div>
        <div class="col-span-2">
          <span class="block text-zinc-300">Instruments</span>
          {entry.data.instruments?.join(', ') || 'N/A'}
        </div>
        <div class="text-right">
          <span class="block text-zinc-300">Log ID</span>
          #{entry.slug.substring(0, 6)}
        </div>
      </div>
    </header>

    <!-- Audio Player (Conditional) -->
    {entry.data.audio_src && (
      <div class="mb-8">
        <AudioPlayer client:load src={entry.data.audio_src} title={entry.data.title} />
      </div>
    )}

    <!-- The Markdown Content -->
    <div class="prose prose-zinc max-w-none prose-headings:font-sans prose-p:font-serif">
      <Content />
    </div>

  </article>

</LogbookLayout>
