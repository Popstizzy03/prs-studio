---
import { getCollection, render } from 'astro:content';
import LogbookLayout from '../../layouts/LogbookLayout.astro';
import AudioPlayer from '../../components/media/AudioPlayer.svelte';
import DataBadge from '../../components/ui/DataBadge.astro';
import Tag from '../../components/ui/Tag.astro';

// 1. Generate static paths for all logs
export async function getStaticPaths() {
  const logs = await getCollection('logs');
  return logs.map(entry => ({
    params: { slug: entry.slug }, props: { entry },
  }));
}

// 2. Get the entry from props
const { entry } = Astro.props;
const { Content } = await render(entry);
---

<LogbookLayout title={entry.data.title}>
  
  <article>
    <!-- Header Meta -->
    <header class="mb-10">
      <div class="flex items-center justify-between mb-6">
        <a href="/" class="group flex items-center gap-2 text-xs font-mono text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors">
          <span class="group-hover:-translate-x-1 transition-transform">‚Üê</span>
          BACK TO INDEX
        </a>
        
        <div class="flex gap-2">
          {entry.data.tags.map(tag => (
            <Tag label={tag} />
          ))}
        </div>
      </div>

      <div class="mb-8">
        <span class="block font-mono text-xs text-orange-600 dark:text-orange-500 mb-2 uppercase tracking-widest">
          {entry.data.date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}
        </span>
        <h1 class="font-sans text-4xl md:text-6xl font-bold tracking-tighter text-zinc-900 dark:text-zinc-50 leading-tight">
          {entry.data.title}
        </h1>
      </div>

      <!-- Technical Data Badges -->
      <div class="flex flex-wrap gap-3 pb-8 border-b border-zinc-200 dark:border-zinc-800 mb-10">
        <DataBadge label="BPM" value={entry.data.bpm || 'Free'} />
        
        {entry.data.instruments && (
          <DataBadge label="Gear" value={entry.data.instruments.join(', ')} />
        )}
        
        <DataBadge label="ID" value={`#${entry.slug.substring(0, 6)}`} color="zinc" />
      </div>
    </header>

    <!-- Audio Player (Conditional) -->
    {entry.data.audio_src && (
      <div class="mb-12">
        <AudioPlayer client:load src={entry.data.audio_src} title={entry.data.title} />
      </div>
    )}

    <!-- The Markdown Content -->
    <div class="prose prose-zinc dark:prose-invert max-w-none prose-headings:font-sans prose-p:font-serif prose-lg">
      <Content />
    </div>

  </article>

</LogbookLayout>
